<!DOCTYPE html>
<html lang="zh" translate="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>龍運轩ᝰ美食中心 · LYX Food Center</title>
<meta name="color-scheme" content="light dark">
<style>
:root{
  --bg:#f7f8fb;--card:#fff;--ink:#0f172a;--mut:#6b7280;--line:#e5e7eb;
  --brand:#0ea5e9;--ok:#059669;--accent:#f59e0b;
  --shadow:0 8px 24px rgba(2,8,23,.06)
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
a{text-decoration:none;color:inherit}
.wrap{max-width:1200px;margin:20px auto;padding:0 12px 24px}
header{position:sticky;top:0;z-index:9;background:linear-gradient(180deg,#0ea5e9,#0284c7);color:#fff;padding:14px 16px}
h1{margin:0;font-size:20px;letter-spacing:.5px;display:flex;gap:10px;align-items:baseline}
h1 small{opacity:.9}
.lang{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.lang button{padding:6px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.45);background:rgba(255,255,255,.12);color:#fff;cursor:pointer;font-weight:700}
.lang button.active{background:#fff;color:#0b3a55}

.grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
@media (max-width:980px){.grid{grid-template-columns:1fr}}
.panel{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow)}
.panel h3{margin:0;padding:14px 16px;border-bottom:1px solid var(--line);font-size:16px;display:flex;align-items:center;gap:8px}
.section{padding:12px 12px 18px}

.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;margin:0 6px 10px}
.label{font-weight:700}
.input{padding:10px;border:1px solid var(--line);border-radius:12px;min-width:140px}
.switch{display:flex;gap:8px;align-items:center;border:1px solid var(--line);border-radius:12px;padding:8px 10px;background:#fff}

details{border:1px solid var(--line);border-radius:14px;margin:10px 0;background:#fff}
summary{list-style:none;cursor:pointer;padding:12px 14px;border-radius:14px;display:flex;justify-content:space-between;align-items:center;font-weight:900;background:#fff7ed;border-left:4px solid var(--accent)}
summary::marker,summary::-webkit-details-marker{display:none}
.cat-sub{color:#a16207;font-weight:600;font-size:12px}

.cards{padding:10px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media (max-width:720px){.cards{grid-template-columns:1fr}}

.item{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff;display:flex;gap:12px;align-items:center}
.item .left{flex:1}
.title{font-weight:900}
.sub{color:var(--mut);font-size:12px;line-height:1.25}
.qty{min-width:56px;text-align:center;font-weight:900}

.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.small{padding:10px 14px;font-size:18px;border-width:2px}
.btn.add{background:var(--brand);border-color:var(--brand);color:#fff;font-weight:800}

.sticky{position:sticky;top:86px}
.sumrow{display:flex;gap:10px;margin-top:10px}
.sumrow .btn.print{flex:1;background:#1d4ed8;border-color:#1d4ed8;color:#fff}
.sumrow .btn.done{flex:3;background:var(--ok);border-color:var(--ok);color:#fff}
.note{width:100%;min-height:68px;border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:10px}
.sum{border-top:1px dashed var(--line);padding-top:10px;margin-top:10px}

.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
.kpi{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff;text-align:center}
.kpi b{display:block;font-size:18px}

.tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.tag{font-size:11px;border:1px solid var(--line);color:var(--mut);padding:2px 6px;border-radius:999px}
.hidden{display:none}

/* === 修复按钮字体在 WebView 白底消失 === */
.btn{background:#fff !important;color:#0f172a !important;-webkit-text-fill-color:#0f172a !important;font-weight:700}
.tools .btn{min-width:140px;text-align:center}
body{color-scheme: light;}
</style>
</head>
<body>
<header>
  <h1><span data-i18n="appName">龍運轩ᝰ美食中心</span> <small data-i18n="appNameEn">LYX Food Center</small></h1>
  <div class="lang">
    <button id="btn-zh" class="active" onclick="applyLang('zh')" data-i18n="lang_zh">中文</button>
    <button id="btn-en" onclick="applyLang('en')" data-i18n="lang_en">English</button>
    <button id="btn-vi" onclick="applyLang('vi')" data-i18n="lang_vi">Tiếng Việt</button>
  </div>
</header>

<div class="wrap grid">
  <!-- 左边菜单 -->
  <section class="panel">
    <h3 data-i18n="orderTitle">点餐 / Order</h3>
    <div class="section">
      <div class="controls">
        <label class="label" data-i18n="tableNo">桌号</label>
        <input id="tableNo" class="input" placeholder="A1">
        <label class="switch">
          <input type="checkbox" id="takeaway">
          <span data-i18n="takeaway">外带</span>
        </label>
      </div>

      <!-- 云吞面 -->
      <details>
        <summary>
          <span data-i18n="cat_wonton">龍兴记ᝰ云吞面</span>
          <span class="cat-sub" data-i18n="subTap">点击展开/收起</span>
        </summary>
        <div class="cards" id="cat-wonton"></div>
      </details>

      <!-- 饮料 -->
      <details>
        <summary>
          <span data-i18n="cat_drinks">饮料</span>
          <span class="cat-sub" data-i18n="ruleCaption">规则见小字</span>
        </summary>
        <div class="cards" id="cat-drinks"></div>
      </details>

      <!-- 婶婶档 -->
      <details>
        <summary>
          <span data-i18n="cat_auntie">婶婶档</span>
          <span class="cat-sub" data-i18n="subTap">点击展开/收起</span>
        </summary>
        <div class="cards" id="cat-auntie"></div>
      </details>

      <!-- 广西卷筒粉 -->
      <details>
        <summary>
          <span data-i18n="cat_guangxi">广西卷筒粉</span>
          <span class="cat-sub" data-i18n="subTap">点击展开/收起</span>
        </summary>
        <div class="cards" id="cat-guangxi"></div>
      </details>
    </div>
  </section>

  <!-- 右边订单 -->
  <aside class="panel sticky">
    <h3 data-i18n="cartTitle">订单 / Cart</h3>
    <div id="cart" class="section"></div>
    <div class="section">
      <label class="label" data-i18n="notes">备注</label>
      <textarea id="note" class="note"></textarea>
      <div class="sumrow">
        <button class="btn print" onclick="printReceipt()" data-i18n="print">打印小票</button>
        <button class="btn done" onclick="finishAndSend()" data-i18n="complete_stats_group">完成并统计（群聊）</button>
      </div>

      <div class="kpis">
        <div class="kpi"><span data-i18n="ordersCount">订单笔数</span><b id="kpi-orders">0</b></div>
        <div class="kpi"><span data-i18n="itemsSold">售出件数</span><b id="kpi-items">0</b></div>
        <div class="kpi"><span data-i18n="salesAmount">销售金额</span><b id="kpi-sales">RM 0.00</b></div>
      </div>

      <div class="tools">
        <button class="btn" onclick="viewToday()">查看明细</button>
        <button class="btn" onclick="viewByCategory()">分类统计</button>
        <button class="btn" onclick="exportCSV('today')">导出今日 CSV</button>
        <button class="btn" onclick="deleteWithPwd()">删单（需密码）</button>
      </div>
    </div>
  </aside>
</div>

<script>
/* 菜单数据 */
const WONTON = [
  {id:"w_small", name_zh:"云吞面（小）", price:6.50},
  {id:"w_mid",   name_zh:"云吞面（中）", price:7.50},
  {id:"w_big",   name_zh:"云吞面（大）", price:8.50},
];
const DRINKS = [
  {id:"coffee_hot", name_zh:"咖啡（热）", price:2.30},
  {id:"coffee_ice", name_zh:"咖啡（冰）", price:2.50},
];
const AUNTIE = [
  {id:"a_panmee", name_zh:"面粉糕", price:6.00},
];
const GUANGXI = [
  {id:"gx_su", name_zh:"素粉(Kosong)", price:1.00},
  {id:"gx_veg", name_zh:"蔬菜卷筒粉", price:2.00},
  {id:"gx_meatveg", name_zh:"菜加肉卷筒粉", price:3.00},
  {id:"gx_meat", name_zh:"肉卷筒粉", price:3.00},
  {id:"gx_full", name_zh:"全家福卷筒粉", price:4.00},
  {id:"gx_roll", name_zh:"春卷", price:1.00},
  {id:"gx_yutou", name_zh:"芋头米糕", price:1.00},
];

/* 渲染 */
const cart={};
function itemCard(it){
  return `<div class="item"><div class="left"><div class="title">${it.name_zh}</div><div>RM ${it.price.toFixed(2)}</div></div>
  <div><button class="btn small" onclick="dec('${it.id}')">-</button><div id="qty-${it.id}" class="qty">${cart[it.id]||0}</div><button class="btn small" onclick="inc('${it.id}')">+</button></div></div>`;
}
function renderCategory(elId,list){
  document.getElementById(elId).innerHTML=list.map(itemCard).join("");
}
function renderAll(){ renderCategory("cat-wonton",WONTON);renderCategory("cat-drinks",DRINKS);renderCategory("cat-auntie",AUNTIE);renderCategory("cat-guangxi",GUANGXI);renderCart(); }

/* 加减 */
function inc(id){ cart[id]=(cart[id]||0)+1;renderCart();syncQty(id);}
function dec(id){ if(!cart[id])return;cart[id]--;if(cart[id]<=0)delete cart[id];renderCart();syncQty(id);}
function syncQty(id){ const q=document.getElementById("qty-"+id);if(q)q.textContent=cart[id]||0;}

/* 购物车 */
function renderCart(){ let subtotal=0,html=""; for(const id in cart){ const item=[...WONTON,...DRINKS,...AUNTIE,...GUANGXI].find(x=>x.id===id); if(!item)continue; subtotal+=item.price*cart[id]; html+=`<div>${item.name_zh} × ${cart[id]} = RM ${(item.price*cart[id]).toFixed(2)}</div>`;} document.getElementById("cart").innerHTML=html+`<div class="sum">合计 Total: RM ${subtotal.toFixed(2)}</div>`; }

/* 分类统计 */
function viewByCategory(){ const groups={"云吞面":WONTON,"饮料":DRINKS,"婶婶档":AUNTIE,"广西卷筒粉":GUANGXI}; let msg="分类统计：\n"; for(const [cat,list] of Object.entries(groups)){ let c=0,s=0; list.forEach(it=>{ if(cart[it.id]){c+=cart[it.id];s+=cart[it.id]*it.price;}}); msg+=`${cat}: ${c}件 RM ${s.toFixed(2)}\n`; } alert(msg); }

/* 其他功能（略简化） */
const DELETE_PWD="Lyx115599$";
function deleteWithPwd(){ const p=prompt("密码"); if(p!==DELETE_PWD){alert("错误");return;}localStorage.clear();alert("已清空");}
document.addEventListener("DOMContentLoaded",renderAll);
</script>
</body>
</html>
